
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Lehrmaterial, Übungen, Aufgaben und Hilfen für Aktuelle Trends der IKT">
      
      
      
        <meta name="author" content="Jörn Freiheit">
      
      
        <link rel="canonical" href="http://freiheit.f4.htw-berlin.de/ikt/backgroundsync/">
      
      <link rel="shortcut icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>Hintergrundsynchronisation - Progressive Web Apps</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#757575">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="grey" data-md-color-accent="indigo">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hintergrundsynchronisation" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="http://freiheit.f4.htw-berlin.de/ikt" title="Progressive Web Apps" class="md-header-nav__button md-logo" aria-label="Progressive Web Apps">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Progressive Web Apps
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Hintergrundsynchronisation
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/jfreiheit/ikt/" title="Quellcode" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="http://freiheit.f4.htw-berlin.de/ikt" title="Progressive Web Apps" class="md-nav__button md-logo" aria-label="Progressive Web Apps">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    Progressive Web Apps
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jfreiheit/ikt/" title="Quellcode" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../einfuehrung/" class="md-nav__link">
        Einführung
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../grundgeruest/" class="md-nav__link">
        Grundgerüst
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../manifest/" class="md-nav__link">
        Manifest
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../serviceworker/" class="md-nav__link">
        Service Worker
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../promises/" class="md-nav__link">
        Promises & fetch
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../caching/" class="md-nav__link">
        Caching
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../backend/" class="md-nav__link">
        Backend
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../frontend/" class="md-nav__link">
        Frontend
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../indexeddb/" class="md-nav__link">
        IndexedDB
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Hintergrundsynchronisation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Hintergrundsynchronisation
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zunachst-ein-bisschen-mehr-responsive" class="md-nav__link">
    Zunächst ein bisschen mehr responsive
  </a>
  
    <nav class="md-nav" aria-label="Zunächst ein bisschen mehr responsive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#media-queries" class="md-nav__link">
    Media Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcset-attribut-fur-img" class="md-nav__link">
    srcset-Attribut für img
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#animationen" class="md-nav__link">
    Animationen
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daten-senden" class="md-nav__link">
    Daten senden
  </a>
  
    <nav class="md-nav" aria-label="Daten senden">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sync-task-registrieren" class="md-nav__link">
    Sync-Task registrieren
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daten-in-die-indexeddb-speichern" class="md-nav__link">
    Daten in die IndexedDB speichern
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ein-fallback" class="md-nav__link">
    Ein Fallback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ereignisbehandlung-des-sync-events" class="md-nav__link">
    Ereignisbehandlung des sync-Events
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../pushnotes/" class="md-nav__link">
        Push Notifications
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../devices/" class="md-nav__link">
        Gerätezugriffe
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../zusammenfassung/" class="md-nav__link">
        Zusammenfassung
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../uebungen/" class="md-nav__link">
        Übungen
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tools/" class="md-nav__link">
        Werkzeuge
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../hilfen/" class="md-nav__link">
        Hilfen
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zunachst-ein-bisschen-mehr-responsive" class="md-nav__link">
    Zunächst ein bisschen mehr responsive
  </a>
  
    <nav class="md-nav" aria-label="Zunächst ein bisschen mehr responsive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#media-queries" class="md-nav__link">
    Media Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#srcset-attribut-fur-img" class="md-nav__link">
    srcset-Attribut für img
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#animationen" class="md-nav__link">
    Animationen
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daten-senden" class="md-nav__link">
    Daten senden
  </a>
  
    <nav class="md-nav" aria-label="Daten senden">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sync-task-registrieren" class="md-nav__link">
    Sync-Task registrieren
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#daten-in-die-indexeddb-speichern" class="md-nav__link">
    Daten in die IndexedDB speichern
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ein-fallback" class="md-nav__link">
    Ein Fallback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ereignisbehandlung-des-sync-events" class="md-nav__link">
    Ereignisbehandlung des sync-Events
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jfreiheit/ikt/edit/master/docs/backgroundsync.md" title="Seite editieren" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="hintergrundsynchronisation">Hintergrundsynchronisation<a class="headerlink" href="#hintergrundsynchronisation" title="Permanent link">&para;</a></h1>
<p>Hintergrundsynchronisation erlaubt die Synchronisation von daten, selbst dann, wenn die Anwendung offline ist. Diese "Synchronisation" erfolgt natürlich "asynchron". Angenommen, Sie geben offline Daten in die Anwendung ein und wollen diese versenden, z.B. an das Backend, dann wird dieser Request so lange in Ihrer Anwendung gespeichert, bis Sie wieder online sind und erst dann ausgeführt. </p>
<p>Das Situation ist die Folgende:</p>
<p><img alt="backgroundsync" src="../files/69_background.png" /></p>
<p>Es sollen Daten an das Backend gesendet werden, aber die Internetverbindung ist unterbrochen. Deshalb werden die Daten in die IndexedDB gespeichert und im Service Worker wird eine <em>Sync Task</em> registriert. </p>
<p><img alt="backgroundsync" src="../files/70_background.png" /></p>
<p>Sobald die Verbindung wieder steht, wird ein <em>Sync</em>-Event im Service Worker ausgelöst und dieser sendet die Daten an das Backend (<code>POST-Request</code>).</p>
<p>Dadurch, dass der Service Worker diesen <code>POST-Request</code> ausführt (und die Daten dabei mitsendet), kann die Hintergrundsynchronisation sogar dann stattfinden, wenn die Webanwendung bereits geschlossen ist! Deshalb sollten wir einfach immer beim Senden von Daten eine <em>Sync Task</em> registrieren, weil es sein kann, dass die Daten noch gar nicht vollständig gesendet wurden, bevor wir den Browsertab schließen. </p>
<h3 id="zunachst-ein-bisschen-mehr-responsive">Zunächst ein bisschen mehr responsive<a class="headerlink" href="#zunachst-ein-bisschen-mehr-responsive" title="Permanent link">&para;</a></h3>
<p>Unser <em>HTW Insta</em> entwickelt sich langsam. Deshalb ist hier vielleicht ein guter Zeitpunkt, um die Anwendung noch etwas mehr <em>responsive</em> zu gestalten. </p>
<h4 id="media-queries">Media Queries<a class="headerlink" href="#media-queries" title="Permanent link">&para;</a></h4>
<p>Zum Beispiel sind die <code>Cards</code> stets in fester Größe, unabhängig davon, ob wir die Anwendung am Desktop betrachten oder am Mobilgerät. </p>
<p>Dazu können wir in unsere <code>feed.css</code> ein paar <em>Media queries</em> einfügen:</p>
<div class="tabbed-set" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">/src/css/feed.css</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="p">#</span><span class="nn">create-post</span> <span class="p">{</span>
    <span class="k">z-index</span><span class="p">:</span> <span class="mi">1001</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">min-height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
    <span class="k">overflow-y</span><span class="p">:</span> <span class="kc">scroll</span><span class="p">;</span>
    <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">56</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
    <span class="k">visibility</span><span class="p">:</span> <span class="kc">hidden</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">main-image</span> <span class="p">{</span>
    <span class="k">max-width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">whiteText</span> <span class="p">{</span>
    <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">floating-button</span> <span class="p">{</span>
    <span class="k">z-index</span><span class="p">:</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
    <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">right</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">input-section</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="kc">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">shared-moment-card</span><span class="p">.</span><span class="nc">mdl-card</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="kc">auto</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">80</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">min-width</span><span class="o">:</span> <span class="nt">600px</span><span class="o">)</span> <span class="p">{</span>
    <span class="p">.</span><span class="nc">shared-moment-card</span><span class="p">.</span><span class="nc">mdl-card</span> <span class="p">{</span>
        <span class="k">width</span><span class="p">:</span> <span class="mi">60</span><span class="kt">%</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">min-width</span><span class="o">:</span> <span class="nt">1200px</span><span class="o">)</span> <span class="p">{</span>
    <span class="p">.</span><span class="nc">shared-moment-card</span><span class="p">.</span><span class="nc">mdl-card</span> <span class="p">{</span>
        <span class="k">width</span><span class="p">:</span> <span class="mi">45</span><span class="kt">%</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">shared-moment-card</span> <span class="p">.</span><span class="nc">mdl-card__title</span> <span class="p">{</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">250</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">min-height</span><span class="o">:</span> <span class="nt">600px</span><span class="o">)</span> <span class="p">{</span>
    <span class="p">.</span><span class="nc">shared-moment-card</span> <span class="p">.</span><span class="nc">mdl-card__title</span> <span class="p">{</span>
        <span class="k">height</span><span class="p">:</span> <span class="mi">300</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">min-height</span><span class="o">:</span> <span class="nt">1200px</span><span class="o">)</span> <span class="p">{</span>
    <span class="p">.</span><span class="nc">shared-moment-card</span> <span class="p">.</span><span class="nc">mdl-card__title</span> <span class="p">{</span>
        <span class="k">height</span><span class="p">:</span> <span class="mi">380</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>       
</code></pre></div>
</div>
</div>
<p>Wir haben sowohl für die Viewport-Höhe als auch für die Viewport-Breite zwei <em>Breakpoints</em> eingebaut. Bei jeweils <code>600px</code> bzw. <code>1200px</code> ändern sich die Angaben zur Höhe bzw. Breite der Bilder in den <code>Cards</code>. <strong>Achtung:</strong> In <code>feed.js</code> muss dazu die Zeile </p>
<div class="highlight"><pre><span></span><code>cardTitle.style.height = &#39;180px&#39;;
</code></pre></div>
<p>gelöscht werden! Die Höhe und Breite der Bilder in den <code>Cards</code> passt sich jetzt (besser)  der Viewport-Breite und -Höhe an. Bei den Breiten haben wir sogar %-Angaben verwendet (gut), bei den Höhen nur feste Pixel-Werte (nicht so gut). Sie können gerne damit herumspielen und es an Ihre Bedürfnisse anpassen. Mehr zu Media Queries finden Sie z.B. <a href="https://www.w3schools.com/css/css_rwd_mediaqueries.asp">hier</a> und <a href="">hier</a><a href="https://wiki.selfhtml.org/wiki/CSS/Media_Queries">https://wiki.selfhtml.org/wiki/CSS/Media_Queries</a>.</p>
<h4 id="srcset-attribut-fur-img">srcset-Attribut für img<a class="headerlink" href="#srcset-attribut-fur-img" title="Permanent link">&para;</a></h4>
<p>Die Verwendung der Bilder können wir noch auf eine andere Art <em>responsive</em> gestalten. Je nach Viewport-Größe können die Bilder eingebunden werden, deren Auflösung "ausreicht". In dem <code>/public/src/images/</code>-Ordner haben wir für unser Hauptbild oben drei verschiedene Versionen:</p>
<ul>
<li><code>htw.jpg</code>, mit der Auflösung <code>898 x 343</code> Pixel,</li>
<li><code>htw-lg.jpg</code>, mit der Auflösung <code>1199 x 457</code> Pixel und</li>
<li><code>htw-sm.jpg</code>, mit der Auflösung <code>480 x 183</code> Pixel.</li>
</ul>
<p>Es wäre unsinnig, beisielsweise das <code>htw-lg.jp</code> auf einem schmalen Viewport anzuzeigen, da dafür die Auflösung des <code>htw-sm.lpg</code> völlig genügt. Da Letzteres auch noch deutlich kleiner ist (<code>43 KB</code>), als das <code>htw-lg.jpg</code>-Bild (<code>170 KB</code>), ließe sich auch die Ladezeit verringern, wenn für mobile Geräte das kleiner Bild verwendet würde. Auf der anderen Seite sieht dieses Bild aufgrund seiner niedrigen Auflösung in großen Viewports (also am Desktop-Monitor) nicht gut aus. Dort benötigen wir das <code>htw-lg.jpg</code>. Um diesen Wechsel der Bilder je nach Viewport-Größe zu vereinfachen, wurde in HTML5 für das <code>img</code>-Element das Attribut <code>srcset</code> hinzugefügt (siehe z.B. <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images">hier</a>  oder <a href="https://html.com/attributes/img-srcset/">hier</a>). In unserer <code>index.html</code> können wir also das Einbinden des <code>img</code>-Elementes wie folgt erweitern:</p>
<div class="tabbed-set" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">/index.html</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>88
89
90
91</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;/src/images/htw-lg.jpg 1200w, </span>
<span class="s">             /src/images/htw.jpg 900w,</span>
<span class="s">             /src/images/htw-sm.jpg 480w&quot;</span> 
     <span class="na">src</span><span class="o">=</span><span class="s">&quot;/src/images/htw.jpg&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;HTW Wilhelminenhof&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;main-image&quot;</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Zuvor stand dort einfach nur: <code>&lt;img src="/src/images/htw.jpg" alt="HTW Wilhelminenhof" class="main-image"&gt;</code>. Wir haben also das <code>srcset</code>-Attribut hinzugefügt. Das generelle Template dafür sieht so aus:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;url size, </span>
<span class="s">             url size,</span>
<span class="s">             url size&quot;</span> 
     <span class="na">src</span><span class="o">=</span><span class="s">&quot;default url&quot;</span> <span class="p">&gt;</span>
</code></pre></div>
<p>Das heißt, nach den URLs auf die jeweiligen Bilder schreiben wir noch die Größe des Viewports, ab denen die Bilder verwendet werden sollen, also <code>1200w, 900w, 480w</code>. Dabei steht <code>w</code> für <code>width</code>. Möglich wäre auch noch, dass man statt <code>w</code> ein <code>x</code> angibt und dann die Anzahl der Pixel verwendet für die Viewportgröße. Das Laden der unterschiedlichen Images kann in den DeveloperTools unter <code>Network</code> beobachtet werden. </p>
<h4 id="animationen">Animationen<a class="headerlink" href="#animationen" title="Permanent link">&para;</a></h4>
<p>Wenn wir auf der Hauptseite auf den <code>+</code>-Button klicken, dann "erscheint" das Formular zur Dateneingabe einfach. Das liegt daran, dass wir in der <code>feed.js</code> bei den Funktionen <code>openCreatePostModal()</code> und <code>closeCreatePostModal()</code> die Sichtbarkeit einfach an- und ausschalten. Wir könnten das aber auch etwas "netter" durch eine Animation gestalten. Dazu verwenden wir <a href="https://developer.mozilla.org/de/docs/Web/CSS/transform-function/translateY()">translateY</a> und <a href="https://developer.mozilla.org/de/docs/Web/CSS/transition">transition</a>. <code>translateY()</code> verschiebt ein Element in <code>y</code>-Richtung (also rauf oder runter) und <code>transition</code> kann eine Zeit übergeben werden, die angibt, wie lange der Wechsel von Werten einer Eigenschaft dauern soll - also eine Animation. </p>
<p>In der <code>feed.ccs</code> ändern wir für die <code>id=create-post</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">#</span><span class="nn">create-post</span> <span class="p">{</span>
    <span class="k">z-index</span><span class="p">:</span> <span class="mi">1001</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">min-height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
    <span class="k">overflow-y</span><span class="p">:</span> <span class="kc">scroll</span><span class="p">;</span>
    <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">56</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
    <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
<span class="hll">    <span class="c">/* visibility: hidden; */</span>
</span>
<span class="hll">    <span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">100</span><span class="n">vH</span><span class="p">);</span>
</span><span class="hll">    <span class="k">transition</span><span class="p">:</span> <span class="k">transform</span> <span class="mf">0.3</span><span class="kt">s</span><span class="p">;</span>
</span><span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Die Zeile <code>11</code> kann natürlich ganz raus. In der <code>feed.js</code> ändern wir für die beiden Methoden:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">function</span> <span class="nx">openCreatePostModal</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">    <span class="nx">createPostArea</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="s1">&#39;translateY(0)&#39;</span><span class="p">;</span>
</span><span class="p">}</span>

<span class="kd">function</span> <span class="nx">closeCreatePostModal</span><span class="p">()</span> <span class="p">{</span>
<span class="hll">    <span class="nx">createPostArea</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="s1">&#39;translateY(100vH)&#39;</span><span class="p">;</span>
</span><span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>und danach "slided" das Formular von unten nach oben ein. <code>vH</code> ist eine Einheit in Relation zum Viewport. <code>100vH</code> ist die gesamte Viewporthöhe, <code>1vH</code> ist der 100te Teil der Viewporthöhe (siehe z.B. <a href="https://wiki.selfhtml.org/wiki/CSS/Wertetypen/Zahlen,_Ma%C3%9Fe_und_Ma%C3%9Feinheiten">hier</a>).</p>
<h3 id="daten-senden">Daten senden<a class="headerlink" href="#daten-senden" title="Permanent link">&para;</a></h3>
<p>In unserer <em>HTW Insta</em>-Anwendung sorgen wir nun zunächst dafür, dass wir auch Daten eingeben und diese versenden können. Ausgangspunkt ist dieser <a href="../files/IKT-PWA-05.zip">Stand des Projektes</a> (noch ohne die responsiven Erweiterungen).</p>
<p>Wir wollen dazu den <code>Speichern</code>-Button aus der <code>index.html</code> </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>76
77
78</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-color--accent&quot;</span>
        <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;post-btn&quot;</span><span class="p">&gt;</span>Speichern
<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
<p>mit der <code>feed.js</code> verbinden. Dazu definieren wir uns zunächst mithilfe von jQuery weitere Variablen für den direkten Zugriff auf Stuerelemente. Wir erweiteren die <code>feed.js</code> um die hervorgehobenen Zeilen:</p>
<div class="tabbed-set" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">/src/js/feed.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nx">shareImageButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#share-image-button&#39;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">createPostArea</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#create-post&#39;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">closeCreatePostModalButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#close-create-post-modal-btn&#39;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">sharedMomentsArea</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#shared-moments&#39;</span><span class="p">);</span>
<span class="hll"><span class="kd">let</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">);</span>
</span><span class="hll"><span class="kd">let</span> <span class="nx">titleInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#title&#39;</span><span class="p">);</span>
</span><span class="hll"><span class="kd">let</span> <span class="nx">locationInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#location&#39;</span><span class="p">);</span>
</span></code></pre></div>
</td></tr></table>
</div>
</div>
<p>Nun können wir einfacher auf das <code>submit</code>-Ereignis des <code>Speichern</code>-Buttons reagieren. Wir melden dazu das Formular an den Ereignislistener für das <code>submit</code>-Ereignis in der <code>feed.js</code> an:</p>
<div class="tabbed-set" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><label for="__tabbed_4_1">/src/js/feed.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>79
80
81
82
83
84
85
86
87
88</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// nicht absenden und neu laden</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Bitte Titel und Location angeben!&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">closeCreatePostModal</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Wir verhindern zunächst das Standardverhalten beim <code>submit</code>-Ereignis, nämlich das Absenden der Daten und das Neuladen der Seite (Zeile <code>80</code>). In Zeile <code>82</code> prüfen wir, ob beide <code>input</code>-Elemente, also sowohl für <code>title</code>, als auch für <code>location</code> einen Wert enthalten. Die JavaScript-<code>trim()</code>-Funktionen entfernt "Leerzeichen" aller Art am Ende des Strings (auch Tabs, Zeilenumbrüche etc.). Sollte eines der beiden (oder beide) Eingabefelder leer sein, beenden wir die Funktion mit einem <code>alert</code> und bleiben in dem Formular. <code>alert</code> ist natürlich nicht so toll, ein <code>toast</code> wäre viel besser, aber wir haben in unserer <code>index.html</code> nur einen <code>toast</code> für das erfolgreiche Speichern vordefiniert. Wenn beide Eingabefelder befüllt sind, wird das Formularfenster verlassen. Wir erweitern diese Funktion nun um die Registrierung an die <em>Sync Task</em>. </p>
<h4 id="sync-task-registrieren">Sync-Task registrieren<a class="headerlink" href="#sync-task-registrieren" title="Permanent link">&para;</a></h4>
<p>Wenn wir das Formular absenden und die in dem Formular eingegebenen Daten speichern wollen, steuern wir dies nun über eine <em>Sync Task</em>. Diese <em>Sync Task</em> sorgt dafür, dass die Daten (irgendwann) tatsächlich gespeichert werden, auch wenn wir gerade offline sind oder während des Speicherns offline geschaltet werden. Für eine solche <em>Sync Task</em> existiert die <a href="https://developer.mozilla.org/en-US/docs/Web/API/SyncManager">SyncManager-API</a>. Wenn Sie auf diesen Link klicken, dann sehen Sie, dass die <code>SyncManager-API</code></p>
<ol>
<li>nur 2 Methoden besitzt, nämlich <code>register()</code> und <code>getTags()</code> und </li>
<li>dass sie bis jetzt leider nur von Chrome und Edge unterstützt wird. Allerdings auch in allen Android-Geräten (mit Chrome oder WebView) und somit trotzdem eine große Reichweite besitzt. </li>
</ol>
<p>Wir erweitern die Anmeldung an den Listener für das <code>submit</code>-Event zunächst wie folgt:</p>
<div class="tabbed-set" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><label for="__tabbed_5_1">/src/js/feed.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// nicht absenden und neu laden</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Bitte Titel und Location angeben!&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">closeCreatePostModal</span><span class="p">();</span>

<span class="hll">    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;SyncManager&#39;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span>
</span><span class="hll">            <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">sw</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">                <span class="nx">sw</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;sync-new-post&#39;</span><span class="p">);</span>
</span><span class="hll">            <span class="p">});</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>In diesem kleinen Code-Stückchen sind einige Dinge beachtenswert. Erstens, wird die <code>SyncManager-API</code> vom Service Worker verwendet, aber wir sind hier ja in <code>feed.js</code>, also in der Webanwendung. Wir können die Registrierung an die <em>Sync Task</em> nicht einfach in die <code>sw.js</code> schreiben, da das auslösende Ereignis der Registrierung (nämlich das Absenden des Formulars) in der Webanwendung stattfindet und wir dieses Ereignis in <code>feed.js</code> behandeln. Wir benötigen in <code>feed.js</code> also einen Zugriff auf den Service Worker. </p>
<p>Dazu fragen wir zunächst, ob der Service Worker überhaupt durch den Browser unterstützt wird und auch, ob die <code>SyncManager-API</code> durch den Browser unterstützt wird. Dies geschieht in Zeile <code>89</code>. Dort fällt auf, dass der Service Worker eine Eigenschaft von <code>navigator</code> ist, die <code>SyncManager-API</code> eine Eigenschaft von <code>window</code>. <a href="https://developer.mozilla.org/de/docs/Web/API/Window">Window</a> ist das Fenster, das ein DOM Dokument (also eine Webanwendung) enthält. Eine Eigenschaft von <code>window</code> ist <code>navigator</code> (also <code>window.navigator</code>). Das <a href="https://developer.mozilla.org/de/docs/Web/API/Window/navigator">Navigator</a>-Objekt liefert Informationen über den Browser, in dem die Anwendung ausgeführt wird. </p>
<p>Die (<code>readonly</code>)-Eigenschaft <code>ready</code> eines Service Workers ist eine Promise, welche <code>resolved</code> ist, sobald der Service Worker <code>active</code> ist. Siehe <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/ready">hier für <code>ready</code></a>. Über diese Promise erlangen wir Zugriff auf den Service Worker in unserer Webanwendung. Die <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/sync">sync</a>-Eigenschaft ist in dem Interface <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration">ServiceWorkerRegistration</a> definiert. Die <code>register()</code>-Funktion ist eine der beiden Methoden aus der <code>SyncManager-API</code> und registriert eine <em>Sync Task</em>. Jeder <em>Sync Task</em> wird ein <code>tag</code> zugewiesen (ähnlich einer <code>id</code>). über diesen <code>tag</code> kann später auf diese <em>Sync Task</em> zugegriffen werden. Wir haben dieser <em>Sync Task</em> den <code>tag</code> <code>'sync-new-post'</code> gegeben. </p>
<p>Die <em>Sync Task</em> ist nun registriert. Allerdings weiß der Service Worker noch gar nicht, was er bei dieser <em>Sync Task</em> überhaupt synchronisieren soll. Das definieren wir jetzt.</p>
<h4 id="daten-in-die-indexeddb-speichern">Daten in die IndexedDB speichern<a class="headerlink" href="#daten-in-die-indexeddb-speichern" title="Permanent link">&para;</a></h4>
<p>Die Daten, die (später) synchronisert werden sollen, werden zunächst in der IndexedDB gespeichert. Dort können Sie so lange bleiben, bis die Webanwendung (wieder) online ist, um dann an das Backend durch den Service Worker gesendet zu werden. Dazu erzeugen wir uns ein passendes JavaScript-Objekt <code>post</code>:</p>
<div class="tabbed-set" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><label for="__tabbed_6_1">/src/js/feed.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// nicht absenden und neu laden</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Bitte Titel und Location angeben!&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">closeCreatePostModal</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;SyncManager&#39;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">sw</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="hll">                <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">                    <span class="nx">id</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span class="hll">                    <span class="nx">title</span><span class="o">:</span> <span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
</span><span class="hll">                    <span class="nx">location</span><span class="o">:</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
</span><span class="hll">                <span class="p">};</span>
</span>                <span class="nx">sw</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;sync-new-post&#39;</span><span class="p">);</span>
            <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Die <code>id</code> wurde hinzugefügt, um einen eindeutigen Identifier für den <code>post</code> in der IndexedDB zu haben (<code>keyPath</code>). Damit der Wert auch eindeutig ist, wird der Zeitstempel zum String umgewandelt und verwendet (Zeile <code>93</code>). </p>
<p>Diesen <code>post</code> wollen wir nun in die IndexedDB speichern. Dazu steht uns aus der <code>db.js</code> die Funktion <code>writeData()</code> zur Verfügung. Diese Funktion erwartet als ersten Parameter den <code>Store</code>, in dem wir den <code>post</code> speichern wollen. Derzeit haben wir einen <code>Store</code> in unserer IndexedDB definiert, den <code>Store</code> <code>posts</code>:</p>
<div class="tabbed-set" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><label for="__tabbed_7_1">/src/js/db.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">idb</span><span class="p">.</span><span class="nx">openDB</span><span class="p">(</span><span class="s1">&#39;posts-store&#39;</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">upgrade</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Create a store of objects</span>
        <span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">createObjectStore</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="hll">            <span class="c1">// The &#39;id&#39; property of the object will be the key.</span>
</span>            <span class="nx">keyPath</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
            <span class="c1">// If it isn&#39;t explicitly set, create a value by auto incrementing.</span>
            <span class="nx">autoIncrement</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">});</span>
        <span class="c1">// Create an index on the &#39;id&#39; property of the objects.</span>
        <span class="nx">store</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Diesen <code>Store</code> verwenden wir aber, um unsere Daten aus der Datenbank/dem Backend zu <em>cachen</em>. Wir verwenden ihn zum Schreiben und Lesen der Daten aus unserer Datenbank. Für das Synchroniseren der neuen Daten benötigen wir deshalb einen weiteren <code>Store</code>. Dazu kopieren wir einfach die <code>Store</code>-Erstellung in der <code>db.js</code> und nennen den neuhinzugekommen <code>Store</code> <code>sync-posts</code>:</p>
<div class="tabbed-set" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><label for="__tabbed_8_1">/src/js/db.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">idb</span><span class="p">.</span><span class="nx">openDB</span><span class="p">(</span><span class="s1">&#39;posts-store&#39;</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">upgrade</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">createObjectStore</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">keyPath</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
        <span class="p">}).</span><span class="nx">createIndex</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>

<span class="hll">        <span class="nx">db</span><span class="p">.</span><span class="nx">createObjectStore</span><span class="p">(</span><span class="s1">&#39;sync-posts&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class="hll">            <span class="nx">keyPath</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="p">}).</span><span class="nx">createIndex</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span>    <span class="p">},</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Gleichzeitig habe ich auch noch ein bisschen den Code gekürzt. Die Kommentare sind raus und das <code>autoIncrement: true</code> ist auch Standard, deshalb muss es nicht mit angegeben werden. Wenn wir die Anwendung nun ausführen, sehen wir unter <code>IndexedDB</code>, dass ein weiterer <code>Store</code> hinzugekommen ist:</p>
<p><img alt="backgroundsync" src="../files/71_background.png" /></p>
<p>Diesen Store verwenden wir nun, um die neuen <code>post</code>-Daten in die IndexedDB zu schreiben:</p>
<div class="tabbed-set" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><label for="__tabbed_9_1">/src/js/feed.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// nicht absenden und neu laden</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Bitte Titel und Location angeben!&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">closeCreatePostModal</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;SyncManager&#39;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">sw</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">id</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
                    <span class="nx">title</span><span class="o">:</span> <span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
                    <span class="nx">location</span><span class="o">:</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
                <span class="p">};</span>
<span class="hll">                <span class="nx">writeData</span><span class="p">(</span><span class="s1">&#39;sync-posts&#39;</span><span class="p">,</span> <span class="nx">post</span><span class="p">)</span>
</span><span class="hll">                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">                        <span class="nx">sw</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;sync-new-post&#39;</span><span class="p">);</span>
</span><span class="hll">                    <span class="p">});</span>
</span>            <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Die Registrierung der <em>Sync Task</em> ist nur dann sinnvoll, wenn die Daten auch tatsächlich in der IndexedDB gespeichert wurden. Deshalb erfolgt die Registrierung in dem <code>resolved</code>-Pfad der <code>writeData</code>-Promise. </p>
<p>Jetzt können wir noch unseren <code>toast</code> verwenden, den wir in der <code>index.html</code> definiert haben. Hierbei handelt es sich um eine <em>Material Design Lite</em>-Komponente <a href="https://getmdl.io/components/#snackbar-section">Snackbar</a>:</p>
<div class="tabbed-set" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><label for="__tabbed_10_1">/index.html</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 98
 99
100
101</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;confirmation-toast&quot;</span> <span class="na">aria-live</span><span class="o">=</span><span class="s">&quot;assertive&quot;</span> <span class="na">aria-atomic</span><span class="o">=</span><span class="s">&quot;true&quot;</span> <span class="na">aria-relevant</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mdl-snackbar mdl-js-snackbar&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mdl-snackbar__text&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mdl-snackbar__action&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>In der <code>feed.js</code> verketten wir die Promise für das Schreiben der Daten in die IndexedDB weiter und bestätigen dies mit einer Snackbar-Nachricht:</p>
<div class="tabbed-set" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><label for="__tabbed_11_1">/src/js/feed.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// nicht absenden und neu laden</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Bitte Titel und Location angeben!&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">closeCreatePostModal</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;SyncManager&#39;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">sw</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">id</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
                    <span class="nx">title</span><span class="o">:</span> <span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
                    <span class="nx">location</span><span class="o">:</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
                <span class="p">};</span>
                <span class="nx">writeData</span><span class="p">(</span><span class="s1">&#39;sync-posts&#39;</span><span class="p">,</span> <span class="nx">post</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="hll">                        <span class="k">return</span> <span class="nx">sw</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;sync-new-post&#39;</span><span class="p">);</span>
</span>                    <span class="p">})</span>
<span class="hll">                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">                        <span class="kd">let</span> <span class="nx">snackbarContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MaterialSnackbar</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#confirmation-toast&#39;</span><span class="p">));</span>
</span><span class="hll">                        <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Eingaben zum Synchronisieren gespeichert!&#39;</span><span class="p">,</span> <span class="nx">timeout</span><span class="o">:</span> <span class="mf">2000</span><span class="p">};</span>
</span><span class="hll">                        <span class="nx">snackbarContainer</span><span class="p">.</span><span class="nx">showSnackbar</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span class="hll">                    <span class="p">});</span>
</span>            <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Beachten Sie, dass Sie das <code>return</code> in Zeile <code>99</code> einfügen, damit die Promise verkettet werden kann. Nachdem Sie nun Daten in das Formular eingegeben und auf <code>Speichern</code> geklickt haben, erscheint für 2 Sekunden unten eine Bestätigungsnachricht:</p>
<p><img alt="backgroundsync" src="../files/72_background.png" /></p>
<h4 id="ein-fallback">Ein Fallback<a class="headerlink" href="#ein-fallback" title="Permanent link">&para;</a></h4>
<p>Wir haben festgelegt, was passieren soll, wenn der Browser <em>Service Worker</em> und die <em>SyncManager-API</em> unterstützt. Wir sollten jedoch ein <em>Fallback</em> einbauen für den Fall, dass das nicht der Fall ist. Viel bleibt uns für diesen Fall nicht übrig, zu tun. Wir können nur versuchen, die Daten, die wir in das Formular eingegeben haben, sofort an das Backend zu senden. </p>
<p>Daten an das Backend senden, können wir bereits. Wir nutzen dazu die <code>fetch()</code>-Funktion und verwenden die <code>POST</code>-Methode. Wir fügen dazu eine Funktion <code>sendDataToBackend()</code> in die <code>feed.js</code> ein und rufen diese im <code>else</code>-Fall für die Behandlung des <code>submit</code>-Ereignisses auf:</p>
<div class="tabbed-set" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><label for="__tabbed_12_1">/src/js/feed.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="hll"><span class="kd">function</span> <span class="nx">sendDataToBackend</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">    <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000/posts&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span class="hll">            <span class="s1">&#39;Accept&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="p">},</span>
</span><span class="hll">        <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span class="hll">            <span class="nx">id</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class="hll">            <span class="nx">title</span><span class="o">:</span> <span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
</span><span class="hll">            <span class="nx">location</span><span class="o">:</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
</span><span class="hll">            <span class="nx">image</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class="hll">            <span class="p">})</span>
</span><span class="hll">    <span class="p">})</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Data sent to backend ...&#39;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
</span><span class="hll">        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span class="hll">    <span class="p">})</span>
</span><span class="hll">    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data ...&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
</span><span class="hll">        <span class="nx">updateUI</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
</span><span class="hll">    <span class="p">});</span>
</span><span class="hll"><span class="p">}</span>
</span>

<span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span> <span class="c1">// nicht absenden und neu laden</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">||</span>  <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Bitte Titel und Location angeben!&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">closeCreatePostModal</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;serviceWorker&#39;</span> <span class="k">in</span> <span class="nx">navigator</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;SyncManager&#39;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">ready</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">sw</span> <span class="p">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">post</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">id</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
                    <span class="nx">title</span><span class="o">:</span> <span class="nx">titleInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
                    <span class="nx">location</span><span class="o">:</span> <span class="nx">locationInput</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
                <span class="p">};</span>
                <span class="nx">writeData</span><span class="p">(</span><span class="s1">&#39;sync-posts&#39;</span><span class="p">,</span> <span class="nx">post</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">sw</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;sync-new-post&#39;</span><span class="p">);</span>
                    <span class="p">})</span>
                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
                        <span class="kd">let</span> <span class="nx">snackbarContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MaterialSnackbar</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#confirmation-toast&#39;</span><span class="p">));</span>
                        <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Eingaben zum Synchronisieren gespeichert!&#39;</span><span class="p">,</span> <span class="nx">timeout</span><span class="o">:</span> <span class="mf">8000</span><span class="p">};</span>
                        <span class="nx">snackbarContainer</span><span class="p">.</span><span class="nx">showSnackbar</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
                    <span class="p">});</span>
            <span class="p">});</span>
<span class="hll">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">sendDataToBackend</span><span class="p">();</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="p">});</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>So ganz toll ist die Fallback-Funktionalität nicht. Dazu müsste die <code>id</code> nicht mit einem festen Wert belegt werden und die <code>image</code>-Eigenschaft mit einem richtigen Bild. Es lässt sich aber einmal ausprobieren, indem man dafür sorgt, dass die Bedingung <code>if('serviceWorker' in navigator &amp;&amp; 'SyncManager' in window)</code> <code>false</code> ist (z.B. <code>&amp;&amp; false</code>), aber es geht hier zunächst nur um das Prinzip und deshalb werden wir uns hier zunächst nicht weiter darum kümmern, dass dies vollständig fehlerfrei durchgeführt werden kann.  </p>
<p>Stattdessen kümmern wir uns nun darum, dass das <code>sync</code>-Ereignis im Service Worker behandelt wird. Das geschieht immer dann, wenn der Service Worker erkennt, dass die Internetverbindung wieder hergestllt wurde. </p>
<h4 id="ereignisbehandlung-des-sync-events">Ereignisbehandlung des <code>sync</code>-Events<a class="headerlink" href="#ereignisbehandlung-des-sync-events" title="Permanent link">&para;</a></h4>
<p>Wenn der Service Worker erkennt, dass die Verbindung zum Internet wieder hergestellt ist, wird automatisch das <code>sync</code>-Event ausgelöst. Dieses Ereignis wird auch dann ausgelöst, wenn die Internetverbindung besteht <strong>und</strong> eine <em>Sync Task</em> registriert wurde. Wir wollen in diesem Fall die Daten aus der IndexedDB an das Backend senden. Dazu erweitern wir die <code>sw.js</code> um die Behandlung des <code>sync</code>-Ereignisses. Wir fügen diese Ereignisbehandlung an das Ende der <code>sw.js</code> ein:</p>
<div class="tabbed-set" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><label for="__tabbed_13_1">sw.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;service worker --&gt; background syncing ...&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;sync-new-post&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;service worker --&gt; syncing new posts ...&#39;</span><span class="p">);</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span>
            <span class="nx">readAllData</span><span class="p">(</span><span class="s1">&#39;sync-posts&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">dataArray</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">data</span> <span class="k">of</span> <span class="nx">dataArray</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data from IndexedDB&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
                        <span class="c1">// diese Daten an das Backend senden (siehe Fallback)</span>
                    <span class="p">}</span>
                <span class="p">})</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Wir fügen dem Service Worker also einen <code>EventListener</code> hinzu, wie wir das bereits von den anderen Ereignisbehandlungen im Service Worker kennen. Das <code>sync</code>-Ereignis gibt auch die <code>tags</code> zurück, unter denen <em>Sync Tasks</em> gespeichert wurden. In unserem Fall war der verwendete <code>tag</code> <code>sync-new-post</code>. Wir verwenden auch erneut <code>event.waitUntil()</code>, um sicherzustellen, dass die Ereignisbehandlung nicht eher verlassen wird, bis alle definierten Anweisungen darin vollständig abgearbeitet wurden. Als erstes greifen wir dann lesend auf die IndexedDB unter Verwendung der <code>readAllData()</code>-Methode aus der <code>db.js</code>.</p>
<p>Diese Methode gibt ein Array aller gespeicherten Datensätze in der IndexedDB im Store <code>sync-posts</code> zurück. Mit einer <code>for</code>-Schleife betrachten wir jeden einzelnen Datensatz. Wir "wissen", dass ein solcher Datensatz ein JavaScript-Objekt mit den Eigenschaften <code>id</code>, <code>title</code> und <code>location</code> ist. </p>
<p>Wir erweitern diese Behandlung nun um den Code, den wir zuvor für das <em>Fallback</em> verwendet haben. Wir senden die Daten an das Backend. Dazu können wir uns den Code von der Fallback-Implementierung kopieren und anpassen:</p>
<div class="tabbed-set" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><label for="__tabbed_14_1">sw.js</label><div class="tabbed-content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;sync&#39;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;service worker --&gt; background syncing ...&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;sync-new-post&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;service worker --&gt; syncing new posts ...&#39;</span><span class="p">);</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span>
            <span class="nx">readAllData</span><span class="p">(</span><span class="s1">&#39;sync-posts&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">dataArray</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">data</span> <span class="k">of</span> <span class="nx">dataArray</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data from IndexedDB&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="hll">                        <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://localhost:3000/posts&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class="hll">                            <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span class="hll">                            <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">                                <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span class="hll">                                <span class="s1">&#39;Accept&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span class="hll">                            <span class="p">},</span>
</span><span class="hll">                            <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span><span class="hll">                                <span class="nx">id</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span><span class="hll">                                <span class="nx">title</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
</span><span class="hll">                                <span class="nx">location</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span>
</span><span class="hll">                                <span class="nx">image</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class="hll">                            <span class="p">})</span>
</span><span class="hll">                        <span class="p">})</span>
</span><span class="hll">                        <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Data sent to backend ...&#39;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
</span><span class="hll">                            <span class="k">if</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">                                <span class="nx">deleteOneData</span><span class="p">(</span><span class="s1">&#39;sync-posts&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span><span class="hll">                            <span class="p">}</span>
</span><span class="hll">                        <span class="p">})</span>
</span><span class="hll">                        <span class="p">.</span><span class="k">catch</span><span class="p">(</span> <span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class="hll">                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error while sending data to backend ...&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
</span><span class="hll">                        <span class="p">})</span>
</span>                    <span class="p">}</span>
                <span class="p">})</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div>
</td></tr></table>
</div>
</div>
<p>Für die Daten, die an das Backend gesendet werden, wird nun, im gegensatz zum Fallback, auf <code>data</code> zugegriffen, da wir ja die Daten senden, die aus der IndexedDB ausgelesen werden. Wenn die Daten erfolgreich an das Backend übertragen worden sind (<code>response.ok</code> in Zeile <code>128</code>), dann werden diese Daten mithilfe der <code>deleteOneDate()</code>-Funktion (aus <code>db.js</code>) gelöscht, da sie in der IndexedDB nicht weiter benötigt werden. Der Store <code>sync-posts</code> ist ja "nur" dazu da, die Daten so lange zwischenzuspeichern, bis sie ins Backend (in die persistente Datenbank) gesendet sind. Sollte stattdessen ein Fehler auftreten, wird er mithilfe von <code>catch()</code> abgefangen und dort ausgegeben. </p>
<p>Wenn wir nun neue Daten in das Formular eingeben und auf Speichern klicken, werden die Daten zum Backend gesendet (ohne einen Wert für die <code>image</code>-Eigenschaft - der Wert von <code>id</code> wird durch die Datenbank erstellt.)</p>
<p>Das Ausprobieren der späteren Hintergrundsynchronisation erfolgt am Sichersten dadurch, dass Sie den Rechner komplett vom WLAN trennen. Das Offline-Schalten des Service Workers genügt dazu häufig nicht (bzw. wird beim Online-Schalten dann manchmal kein <code>sync</code>-Ereignis ausgelöst).</p>
<ol>
<li>Schalten Sie das WLAN an Ihrem Rechner aus. </li>
<li>Geben Sie über das Formular der Anwendung neue Daten ein und drücken Sie auf den <code>Speichern</code>-Button. </li>
<li>Schauen Sie in den Developer Tools unter <code>IndexedDB</code> in den Store <code>sync-posts</code>. Dort sollten die neuen Daten nun gespeichert sein. </li>
<li>Schalten Sie das WLAN wieder ein. Auf der Konsole erscheint die <code>fetch</code>-Nachricht für <code>POST "http://localhost:3000/posts"</code>.</li>
<li>In der persistenten Datenbank stehen die neuen Daten. </li>
<li>Nach einem Reload der Anwendung werden diese Daten aus der Datenbank über das Backend gelesen (ohne Bilder) und erscheinen als weitere <code>Cards</code>.</li>
</ol>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Wir haben die Hintergrundsynchronisation implementiert! Das Senden der Daten an das Backend erfolgt über das Registrieren einer <em>Sync Task</em> und dem (zwischen-)Speichern der zu sendenden Daten in der IndexedDB. Durch die Ereignisbehandlung des <code>sync</code>-Ereignisses werden diese Daten an das Backend (und darüber in die Datenbank) geschrieben. Das <code>sync</code>-Ereignis wird ausgelöst, wenn der Service Worker online und eine <em>Sync Task</em> registriert ist. Wir können nun Daten eingeben und speichern, egal, ob wir online oder offline sind. Die Anwendung kann sogar geschlossen sein und trotzdem synchronisiert der Service Worker. </p>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../indexeddb/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Zurück
                </span>
                IndexedDB
              </div>
            </div>
          </a>
        
        
          <a href="../pushnotes/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Weiter
                </span>
                Push Notifications
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Jörn Freiheit
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "In Zwischenablage kopieren", "clipboard.copied": "In Zwischenablage kopiert", "search.config.lang": "de", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Suche", "search.result.placeholder": "Suchbegriff eingeben", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.term.missing": "Es fehlt"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['instant', 'tabs'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>